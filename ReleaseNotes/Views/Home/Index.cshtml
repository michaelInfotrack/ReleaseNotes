@model ReleaseNotes.Models.ResultsModel

@{
    ViewBag.Title = "Home Page";
}




<div class="jumbotron">

    <h1 align="center">Releases</h1>

</div>

<div class="row">

    <br />
    @using (Html.BeginForm("GetByDate", "Home", FormMethod.Get))
    {
        
        <div class="col-lg-3">
            @Html.Label("Release Date")
            @Html.TextBox("releaseLabelDate", Model.SelectedDate, new { @class = "date-picker form-control" })
        </div>

        <div class="col-lg-2">
            @Html.Label("Release Label")
            @Html.TextBox("releaseLabel", (string.IsNullOrEmpty(Model.SelectedReleaseLabel) ? Model.DefaultReleaseLabel : Model.SelectedReleaseLabel), new { @class = "form-control" })            
        </div>

        <div class="col-lg-2" style="margin-top:4px;" >
            <br />
            <input type="submit" value="Get Release" class="btn btn-primary" />
        </div>
        <br />
        <br />
        <br />
        <br />
    }
</div>


    @if (Model.JiraIssues.Count == 0)
    {
        <div class="col-lg-2">
            No results found
        </div>

        <br />
    }


    @foreach (var item in Model.JiraIssues.GroupBy(x => x.Project).ToList())
    {
        <table class="table table-striped table-hover">
            <thead>
                <tr  style="background-color:black">
                    <td colspan="4" style="text-align:center; color:white; font-weight:bold">@(Model.GetEnumDescription(item.FirstOrDefault().Project) ?? "Other")</td>
                </tr>
                <tr style="color:white; font-weight:bold; text-decoration:underline">
                    <td style="width: 10%">Jira Id</td>
                    <td style="width: 20%">Assignee</td>
                    <td style="width: 60%">Summary</td>
                    <td style="width: 10%">Status</td>
                </tr>
            </thead>
            @foreach (var issue in item)
            {
                <tr>
                    <td style="width:auto"><a target="_blank" href="https://infotrack.atlassian.net/browse/@issue.Key">@issue.Key</a></td>
                    <td>@issue.Assignee</td>
                    <td>@issue.Summary</td>
                    <td>@issue.Status</td>
                </tr>
            }
        </table>
        <br />
    }

    @if (Model.JiraIssues.Count > 0)
    {
        <div class="row" style="text-align:right; margin-right:2px">

            @using (Html.BeginForm("GenerateEmail", "Home", FormMethod.Post))
            {
                @Html.Hidden("releaseLabel", "")
                <input type="submit" value="Generate Email" class="btn btn-primary" />
            }

            @if (ViewBag.Message != null)
            {
                <script type="text/javascript">
                    window.onload = function () {
                        alert("@ViewBag.Message.ToString().Replace("'", "")");
                    };
                </script>
            }
        </div>
    }

    
